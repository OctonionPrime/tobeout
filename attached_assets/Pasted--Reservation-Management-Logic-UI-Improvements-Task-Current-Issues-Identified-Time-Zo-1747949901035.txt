# Reservation Management - Logic & UI Improvements Task

## Current Issues Identified

### **Time Zone & Logic Problems:**
- Current time: 23.05.2025 00:31 (Moscow time should be used)
- Cancelled reservations not showing in "Upcoming" (but they should be filtered out)
- Status filtering seems inconsistent
- Date logic may not be timezone-aware

### **UI/UX Issues:**
- Status dropdown feels disconnected from the main interface
- Filter tabs (Upcoming/Past/All) vs Status dropdown create confusion
- Guest information showing "No phone" instead of actual phone numbers
- Missing actions for reservation management

## Code Logic Checks for AI Developer

### **1. Time Zone Handling**
```javascript
// Check these areas in your code:

// Frontend - ensure Moscow timezone is used
const moscowTime = new Date().toLocaleString("en-US", {timeZone: "Europe/Moscow"});

// Backend - check if dates are stored/compared in Moscow time
// Look for: date comparisons, "upcoming" vs "past" logic

// Database queries - verify timezone handling
SELECT * FROM bookings WHERE date >= CURRENT_DATE AT TIME ZONE 'Europe/Moscow'
```

### **2. Status Filter Logic**
```javascript
// Check reservation filtering logic:

// Problem: Status dropdown AND tab filters might conflict
// Current logic might be:
// Tab: "Upcoming" + Status: "Cancelled" = No results (incorrect)

// Should be:
if (tab === 'upcoming') {
  // Show only future reservations (regardless of status)
  reservations = reservations.filter(r => r.date >= today)
} else if (tab === 'past') {
  // Show only past reservations
  reservations = reservations.filter(r => r.date < today)
}

// THEN apply status filter
if (statusFilter !== 'all') {
  reservations = reservations.filter(r => r.status === statusFilter)
}
```

### **3. Guest Data Issues**
```javascript
// Check guest data fetching:

// Issue: Showing "Guest - No phone" instead of actual guest data
// Check if guest relationship is properly loaded:

// Backend API should include:
{
  "guest": {
    "name": "Pavel",
    "phone": "+79557877777",
    "email": "guest@example.com"
  }
}

// Frontend should display actual guest data, not placeholder
```

### **4. Date Comparison Logic**
```javascript
// Verify date comparison logic:

// Current issue: May not properly categorize upcoming vs past
const today = new Date(); // Should be Moscow time
const reservationDate = new Date(reservation.date);

// Check if this comparison accounts for:
// - Time zones
// - Time of day (not just date)
// - Reservation duration
```

## UI Improvements Needed

### **1. Redesign Status Filtering**

#### **Current (Problematic):**
```
[Upcoming] [Past] [All] ... [Status Dropdown ▼]
```

#### **Improved Option A - Combined Tabs:**
```
[All] [Upcoming] [Past] [Confirmed] [Pending] [Cancelled] [Completed]
```

#### **Improved Option B - Cleaner Separation:**
```
Time Filter: [All] [Upcoming] [Past]
Status Filter: [All Status ▼] [Confirmed] [Pending] [Cancelled]
```

#### **Improved Option C - Sidebar Filters:**
```
┌─ Filters ────────┐  ┌─ Reservations ──────┐
│ Time Period:     │  │ May 23, 2025        │
│ ○ All            │  │ ├ Pavel - 17:30     │
│ ○ Upcoming       │  │ └ Guest - 20:00     │
│ ● Past           │  │                     │
│                  │  │ May 28, 2025        │
│ Status:          │  │ └ Guest - 20:00     │
│ ☑ Confirmed      │  └─────────────────────┘
│ ☑ Pending        │
│ ☐ Cancelled      │
└──────────────────┘
```

### **2. Improve Reservation Display**

#### **Current Issues:**
- Guest shows "No phone" instead of actual data
- Missing guest names (shows "Guest" instead of "Pavel")
- No action buttons
- Poor visual hierarchy

#### **Improved Layout:**
```
┌─────────────────────────────────────────────────────────────┐
│ Pavel Petrov          17:30, May 23, 2025    Table 5       │
│ +79557877777          2 guests               Confirmed      │
│ pavel@email.com       Window seat            [Edit] [Call]  │
└─────────────────────────────────────────────────────────────┘
```

### **3. Add Missing Action Buttons**
- **Edit Reservation** - Modify time, guests, table
- **Call Guest** - Quick phone action  
- **Email Guest** - Send confirmation/reminder
- **Cancel Reservation** - Change status
- **Mark as Completed** - For finished reservations
- **Mark as No-Show** - Track guest reliability

### **4. Improve Visual Status Indicators**

#### **Status Colors & Icons:**
- 🟢 **Confirmed** - Green badge
- 🟡 **Pending** - Yellow badge  
- 🟠 **Waiting** - Orange badge
- 🔴 **Cancelled** - Red badge
- ⚫ **No-Show** - Dark badge
- ✅ **Completed** - Green check

### **5. Add Time Context**
```
┌─ Today's Reservations ─────────────────┐
│ Now: 00:31 Moscow Time                 │
│                                        │
│ Next Arrival: Pavel at 17:30 (in 17h) │
│ ├ Table 5 ready                        │
│ └ Special request: Window seat         │
└────────────────────────────────────────┘
```

## Specific Code Areas to Check

### **1. API Endpoints**
```javascript
// Check these endpoints:
GET /api/reservations?tab=upcoming&status=confirmed
GET /api/reservations?date_from=2025-05-23&date_to=2025-05-30

// Verify they return correct data structure:
{
  "reservations": [
    {
      "id": 1,
      "date": "2025-05-23",
      "time": "17:30",
      "status": "confirmed",
      "guest": {
        "name": "Pavel",
        "phone": "+79557877777"
      },
      "table": {
        "id": 5,
        "name": "Table 5",
        "location": "Window"
      }
    }
  ]
}
```

### **2. Frontend State Management**
```javascript
// Check state consistency:
const [activeTab, setActiveTab] = useState('upcoming');
const [statusFilter, setStatusFilter] = useState('all');
const [reservations, setReservations] = useState([]);

// Verify filters work together correctly
useEffect(() => {
  fetchReservations(activeTab, statusFilter);
}, [activeTab, statusFilter]);
```

### **3. Date/Time Utilities**
```javascript
// Create/check timezone utilities:
const moscowTime = () => {
  return new Date().toLocaleString("en-US", {timeZone: "Europe/Moscow"});
};

const isUpcoming = (reservationDate) => {
  const moscow = new Date().toLocaleString("en-US", {timeZone: "Europe/Moscow"});
  return new Date(reservationDate) > new Date(moscow);
};
```

## Logic Flow Corrections

### **Current Problematic Flow:**
1. User selects "Upcoming" tab
2. User selects "Cancelled" status  
3. System shows no results (because cancelled reservations aren't "upcoming")
4. User confusion

### **Corrected Logic Flow:**
1. **Time Filter** (Upcoming/Past/All) filters by date
2. **Status Filter** filters by reservation status within time range
3. Both filters work together logically
4. Clear results with proper messaging

### **Example Corrected Filtering:**
- **Upcoming + All Status**: Future reservations regardless of status
- **Upcoming + Confirmed**: Future confirmed reservations only
- **Upcoming + Cancelled**: Future reservations that were cancelled
- **Past + Completed**: Past reservations that were completed

## UI Mockup Suggestions

### **Option 1: Clean Tabs**
```
┌─────────────────────────────────────────────────────────┐
│ [Today] [Upcoming] [Past] [All]     Status: [All ▼]    │
├─────────────────────────────────────────────────────────┤
│ 📅 May 23, 2025                                        │
│                                                         │
│ 🟢 Pavel Petrov      17:30    Table 5    [Edit] [Call] │
│    +79557877777      2 guests  Window                   │
│                                                         │
│ 🟡 Guest User        20:00    Auto      [Edit] [Call]  │
│    No phone          4 guests  Assign                   │
└─────────────────────────────────────────────────────────┘
```

### **Option 2: Sidebar Layout**
```
┌─ Filters ──────┐ ┌─ Reservations ─────────────────────┐
│ Time:          │ │ Today - May 23, 2025              │
│ ● Today        │ │                                   │
│ ○ Upcoming     │ │ 🟢 Pavel Petrov    17:30  Table 5 │
│ ○ Past         │ │    +79557877777    Window seat    │
│ ○ All          │ │    [Edit] [Call] [Email]          │
│                │ │                                   │
│ Status:        │ │ 🟡 Guest User      20:00  Pending │
│ ☑ Confirmed    │ │    No phone        4 guests       │
│ ☑ Pending      │ │    [Edit] [Assign Table]          │
│ ☐ Cancelled    │ │                                   │
│ ☐ Completed    │ └───────────────────────────────────┘
└────────────────┘
```

## Implementation Priority

### **High Priority (Fix Logic):**
1. Fix timezone handling (Moscow time)
2. Correct filter logic (tabs + status working together)
3. Fix guest data display (show actual names/phones)
4. Add proper date categorization

### **Medium Priority (Improve UX):**
1. Redesign filter interface
2. Add action buttons
3. Improve visual status indicators
4. Add time context display

### **Low Priority (Polish):**
1. Add search functionality
2. Implement bulk actions
3. Add export features
4. Create reservation templates

This should give your AI developer a clear roadmap to fix both the logic issues and improve the user experience!